<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3js test step page</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="css/main.css">
</head>
<body>

<div class="container-fluid">
    <div class="row" style="height:70px; margin-bottom: 15px"; >
        <div class="col col-10 col-md-10 form-inline" style="background-color:lavender;"><h1>分析测试步骤</h1></div>
        <div class="col col-1 col-md-1 form-inline" style="background-color:lavender;">
            <a href="query.html"><button type="button" class="btn btn-outline-primary" id="btnHome" style="background-color: white">
                <i class="fa fa-home" aria-hidden="true"></i>
            </button></a>
        </div>
        <div class="col col-1 col-md-1 form-inline" style="background-color:lavender;">
            <a href="javascript:history.back(-1)"> <button type="button" class="btn btn-outline-primary" id="btnBack" style="background-color: white">
                <i class="fa fa-backward" aria-hidden="true"></i>
            </button></a>
        </div>
    </div>
</div>
<div class="container-fluid">

    <div class="row" style="margin-left: 50px;margin-right: 50px" >
        <h4><div id="name"></div></h4>
    </div>
    <div class="row" style="margin-left: 50px;margin-right: 50px" >
        <h6><div id="name2"></div></h6>
    </div>
</div>


<div class="container-fluid" style="height:450px;padding-left: 50px;padding-right: 50px">
    <div class="row">
        <div class="col col-1 col-md-1 ">
            <div class="row" style="height:100px;text-align:center;">
                <button type="button" class="btn btn-outline-primary btn-sm" style="width: 100px;height: 100px;border-radius:50%"  >
                     14
                </button>
            </div>
            <div class="row">

                <button type="button" class="btn btn-outline-primary btn-sm" id="btnShowreq" style="margin-top:20px;width: 100%" >
                    <i class="fa fa-file-code-o " aria-hidden="true"></i> 查看reqDom
                </button>
            </div>
            <div class="row">

                <button type="button" class="btn btn-outline-primary btn-sm" id="btnShowres" style="margin-top:20px;width: 100%" >
                    <i class="fa fa-file-code-o " aria-hidden="true"></i> 查看resDom
                </button>
            </div>
            <div class="row">
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnShowdom" style="margin-top:20px;width:  100%" >
                    <i class="fa fa-file-o " aria-hidden="true"></i> 查看DOM文件
                </button>

            </div>
            <div class="row">
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnShowscreenshot" style="margin-top:20px;width:  100%" >
                    <i class="fa fa-file-image-o " aria-hidden="true"></i> 查看点击截图
                </button>

            </div>
            <div class="row">
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnShowlog" style="margin-top:20px;width:  100%" >
                    <i class="fa fa-file-text-o " aria-hidden="true"></i> 查看日志文件
                </button>

            </div>
        </div>
        <div class="col col-11 col-md-11 " style="">
            <div class="row">
                <div class="col col-12 col-md-12 " >
                    <table class="table  table-hover" style="font-size: 15px">
                        <thead>
                        <tr>
                            <th  width="10%">项目</th>
                            <th >内容</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>reqDom</td>
                            <td>点击左侧按钮查看</td>
                        </tr>
                        <tr>
                            <td>reqHash</td>
                            <td><div id="reqHash"></div></td>
                        </tr>
                        <tr>
                            <td>resDom</td>
                            <td>点击左侧按钮查看</td>
                        </tr>
                        <tr>
                            <td>resHash</td>
                            <td><div id="resHash"></div></td>
                        </tr>
                        <tr>
                            <td>reqImg</td>
                            <td><div id="reqImg"></div></td>
                        </tr>
                        <tr>
                            <td>resImg</td>
                            <td><div id="resImg"></div></td>
                        </tr>
                        <tr>
                            <td>reqTime</td>
                            <td><div id="reqTime"></div></td>
                        </tr>
                        <tr>
                            <td>resTime</td>
                            <td><div id="resTime"></div></td>
                        </tr>
                        <tr>
                            <td>clickedIndex</td>
                            <td><div id="clickedIndex"></div></td>
                        </tr>
                        <tr>
                            <td>action</td>
                            <td><div id="action"></div></td>
                        </tr>
                        <tr>
                            <td>element</td>
                            <td><div id="ElementStoreName"></div></td>
                        </tr>
                        <tr>
                            <td>-url</td>
                            <td><div id="Elements_ulr"></div></td>
                        </tr>
                        <tr>
                            <td>-tag</td>
                            <td><div id="Elements_tag"></div></td>
                        </tr>
                        <tr>
                            <td>-id</td>
                            <td><div id="Elements_id"></div></td>
                        </tr>
                        <tr>
                            <td>-name</td>
                            <td><div id="Elements_name"></div></td>
                        </tr>
                        <tr>
                            <td>-text</td>
                            <td><div id="Elements_text"></div></td>
                        </tr>
                        <tr>
                            <td>-instance</td>
                            <td><div id="Elements_instance"></div></td>
                        </tr>
                        <tr>
                            <td>-depth</td>
                            <td><div id="Elements_depth"></div></td>
                        </tr>
                        <tr>
                            <td>-valid</td>
                            <td><div id="Elements_valid"></div></td>
                        </tr>
                        <tr>
                            <td>-selected</td>
                            <td><div id="Elements_selected"></div></td>
                        </tr>
                        <tr>
                            <td>-xpath</td>
                            <td><div id="Elements_xpath"></div></td>
                        </tr>
                        <tr>
                            <td>-ancestor</td>
                            <td><div id="Elements_ancestor"></div></td>
                        </tr>
                        <tr>
                            <td>-x</td>
                            <td><div id="Elements_x"></div></td>
                        </tr>
                        <tr>
                            <td>-y</td>
                            <td><div id="Elements_y"></div></td>
                        </tr>
                        <tr>
                            <td>-width</td>
                            <td><div id="Elements_width"></div></td>
                        </tr>
                        <tr>
                            <td>-height</td>
                            <td><div id="Elements_height"></div></td>
                        </tr>
                        <tr>
                            <td>-action</td>
                            <td><div id="Elements_action"></div></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col col-12 col-md-12 form-inline">
            <div class="col col-2 col-md-2 form-inline">            </div>
            <div class="col col-2 col-md-2 form-inline">
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnGetpath"  >
                    生成遍历路径
                </button>
            </div>
            <div class="col col-1 col-md-1 form-inline">            </div>
            <div class="col col-2 col-md-2 form-inline">
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnGetwid"  >
                    获取未遍历控件
                </button>
            </div>
            <div class="col col-1 col-md-1 form-inline">
            </div>
            <div class="col col-2 col-md-2 form-inline">
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnGetnext"  >
                    获取下一步遍历路径
                </button>
            </div>
            <div class="col col-2 col-md-2 form-inline">
            </div>

            <div id="nameee"></div>
        </div>
    </div>
</div>


<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery.params.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.v5.min.js"></script>
<script src="js/d3js-example-neo4j.js"></script>
<script type="text/javascript">
    "use strict";
    //######################### const #########################
    var graphWidth =(document.documentElement.clientWidth-15)/12*11;// 1024; //default
    var graphHeight = 450;

    var neo4jAPIURL = 'http://localhost:7474/db/data/transaction/commit';
    var neo4jLogin = 'neo4j';
    var neo4jPassword = 'password';

    var circleSize = 20;

    //######################### variable #########################
    var nodeItemMap = {};
    var id;
    var nodeItem;
    var neo4jNodeItm;


$("td,th").addClass("text-center");

    function submitQuery(nodeID) {
        var queryStr =  'match (n)  where id(n) = ' + nodeID + ' return n';
        var jqxhr = $.post(neo4jAPIURL, '{"statements":[{"statement":"' + queryStr + '", "resultDataContents":["graph"]}]}',
            function(data) {
          //  console.log(data);
                if (data.results != null && data.results.length > 0 && data.results[0].data != null && data.results[0].data.length > 0) {
                    var neo4jDataItmArray = data.results[0].data;
                 //   console.log(neo4jDataItmArray);
                    neo4jDataItmArray.forEach(function(dataItem) {
                        neo4jNodeItm=dataItem.graph.nodes[0];
                        console.log(neo4jNodeItm);//！！
                        if (dataItem.graph.nodes != null && dataItem.graph.nodes.length > 0) {//整个if都可以删掉了
                            var neo4jNodeItmArray = dataItem.graph.nodes;
                            var ccc=dataItem.graph.nodes[0];
                            //neo4jNodeItm=dataItem.graph.nodes[0];
                            console.log(ccc);//！！！

                          var bbb=neo4jNodeItmArray.id;
                            console.log(bbb);
                            console.log("bbb");
                            neo4jNodeItmArray.forEach(function(nodeItm) {
                                    nodeItemMap[nodeItm.id] = nodeItm;
                                    nodeItem=nodeItm;
                                    //console.log("aaa");
                            });
                        }
                    });
                    return;
                }
            }, 'json');



    }
    function fillData(){

        //submitQueryNode(id);
        submitQuery(id);
        $("#nameee").text(id);


      //  console.log(neo4jNodeItm);
       // sleep(5000);


       // $("#name").text(neo4jDataItmArray.name);
       // $("#Number").text(neo4jDataItmArray.graph.nodes[0].properties.Elements_tag);
      //  console.log(nodeItemMap);
     //   console.log(nodeItemMap[201]);
        //console.log(nodeItemMap[201][id]);
     //   console.log(JSON.stringify(nodeItemMap))
        //console.log(JSON.parse(JSON.stringify(nodeItemMap)));
        //console.log(JSON.parse(JSON.stringify(nodeItem)));
      //  console.log(nodeItem);
      //  console.log(JSON.stringify(nodeItem))
/*
        for( var key in nodeItemMap)
            console.log(nodeItemMap[key][id]);
        for( var key in nodeItem)
            console.log(nodeItem[key][id]);
*/

       // console.log(Object.keys(nodeItemMap));
       // console.log(Object.keys(nodeItem));
      //  console.log(Object.values(nodeItemMap));
   //     console.log(Object.values(nodeItem));


/*        var aa;
        nodeItemMap.forEach(function(Itm){aa=Itm;});
        console.log(aa);*/

       // results[""0""].data[""0""].graph.nodes[""0""].labels[""0""]
    }

    //想得到nodeItemMap的值，在代码中console.log输出nodeItemMap和nodeItem的不同形式都不可以，其中一种显示{}，点击展开才有内容。
    // 直接在chrome的console中输入变量却可以看到。
    // 最终使用neo4jNodeItm=dataItem.graph.nodes[0]; 得到内容，但只在当前函数内有效(但是函数外的 console.log(nodeItemMap)仍然可以显示)
    // ，在fillData函数中console输出仍为空，考虑是异步




    //Page Init
    $(function() {
        setupNeo4jLoginForAjax(neo4jLogin, neo4jPassword);
        id = $.query.get("id");
    id=201;//测试用

        fillData();

    });
</script>
</body>
</html>