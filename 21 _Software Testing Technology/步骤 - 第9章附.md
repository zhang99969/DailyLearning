```shell
python manage.py runserver #启动服务器
python functional_tests.py #功能测试
python manage.py test functional_tests #第六章后的功能测试
python manage.py test #单元测试
python manage.py test lists #第六章后的单元测试
  
python manage.py makemigrations #数据库迁移命令
python manage.py migrate #创建数据库

STAGING_SERVER=39.96.9.216 python3 manage.py test functional_tests ##有服务器后在本地功能测试
```

## 附第九章2019.5.9课下

1. 在https://promotion.aliyun.com/ntms/act/campus2018.html 选择购买云服务器ECS。设置root的密码，要求包括大小写字母与数字。进入云服务器管理控制台，选择新购买的实例。在操作栏中选择远程连接，记录并输入6位数字远程连接密码。

2. 依次输入以下命令，并在必要时选择Y或者install the package maintainer''s version。完成后在浏览器中输入服务器实例的公网IP，如http://39.96.9.216/ 。可以看到如下下方内容。
```shell
    apt-get update
    apt-get upgrade
    sudo apt-get install nginx
    sudo systemctl start nginx
```

    >   Welcome to nginx!
    >   If you see this page, the nginx web server is successfully installed and working. Further configuration is required.
    >   For online documentation and support please refer to >[nginx.org](http://nginx.org/).
    >   Commercial support is available at [nginx.com](http://nginx.com/).
    >   *Thank you for using nginx.*

3. 输入sudo add-apt-repository ppa:fkrull/deadsnakes提示command not found，需要输入以下命令，参考https://www.jianshu.com/p/e50e6d46ea62
```shell
sudo apt-get install python-software-properties
sudo apt-get install software-properties-common
```

4. 依次输入以下命令，并在必要时按ENTER或者输入Y。输入`STAGING_SERVER=39.96.9.216 python manage.py test functional_tests`来测试。
```shell
sudo add-apt-repository ppa:fkrull/deadsnakes
sudo apt-get update
sudo apt-get install python3.6 python3.6-venv
sudo apt-get install git
```
5. 修改superlists/settings.py的DATABASES一行为`'NAME': os.path.join(BASE_DIR, '../database/db.sqlite3'),`。在Linux shell中输入`mkdir ../database`，在Cmd中输入`python manage.py migrate --noinput`，在Linux shell中输入`ls ../database/`可以看到db.sqlite3文件。

6. 依次输入以下命令。
```shell
export SITENAME=39.96.9.216
mkdir -p ~/sites/$SITENAME/database
mkdir -p ~/sites/$SITENAME/static
mkdir -p ~/sites/$SITENAME/virtualenv
```

    > 在重启控制台后需要重新设置`export SITENAME=39.96.9.216`

7. 接着输入`git clone https://github.com/zhang99969/suplerlists.git \
~/sites/$SITENAME/source` 。 (也可以使用Xshell连接服务器后，使用Xftp在对应的路径上传代码。后面就不可以了)

    >创建新的本地仓库，存放suplerlists。在github中创建suplerlists仓库。在本地仓库目录下使用git bash
    >echo "# suplerlists" >> README.md
    >git init
    >git add README.md
    >git commit -m "first commit"
    >git remote add origin https://github.com/zhang99969/suplerlists.git
    >git push -u origin master
    >在github仓库中可以看到README.md文件。接着输入以下代码后可以在github仓库中看到上传的代码。
    >git add .
    >git status
    >git commit -m "add codes"
    >git push -f origin master

8. 输入`cd ~/sites/$SITENAME/source`后运行`python manage.py runserver`会提示`SyntaxError: invalid syntax`错误，因为还没安装Django。

9. 在git bash中本地仓库目录下输入以下代码。在服务器远程连接终端(或者Xshell终端)中输入)`git pull`。
```shell
echo "django==1.11" > requirements.txt
git add requirements.txt
git commit -m "Add requirements.txt for virtualenv"
git push
```

   >或者`echo "django==1.11.20" > requirements.txt`

9. 在服务器远程连接终端中输入`pwd`显示/root/sites/39.96.9.216/source，依次输入以下代码，会看到下方内容。接着输入`../virtualenv/bin/pip install -r requirements.txt`来下载Django。
```shell
python3.6 -m venv ../virtualenv
ls ../virtualenv/bin
```

    >activate      activate.fish  easy_install-3.6  pip3    python   python3.6
    >activate.csh  easy_install   pip               pip3.6  python3

11. 在服务器远程连接终端中输入`../virtualenv/bin/python manage.py runserver`提示

    >Performing system checks...
    >
    >System check identified no issues (0 silenced).
    >
    >You have 16 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, lists, sessions.
    >Run 'python manage.py migrate' to apply them.
    >
    >May 09, 2019 - 05:43:04
    >Django version 1.11, using settings 'suplerlists.settings'
    >Starting development server at http://127.0.0.1:8000/
    >Quit the server with CONTROL-C.

12. 在Xftp中打开/etc/nginx/sites-available/路径，并新建39.96.9.216文件，内容为下。
    >server {
    >	listen 80;
    >	server_name 39.96.9.216;
    >	location / {
    >	proxy_pass http://localhost:8000;
    >    }
    >}

13. 依次在服务器远程连接终端中输入以下命令。最后一条命令会提示下方内容。
```shell
echo $SITENAME #查看是否还存在
sudo ln -s ../sites-available/$SITENAME /etc/nginx/sites-enabled/$SITENAME
ls -l /etc/nginx/sites-enabled
```

    >lrwxrwxrwx 1 root root 30 May  9 13:51 39.96.9.216 -> ../sites-available/39.96.9.216
    >lrwxrwxrwx 1 root root 34 May  9 10:34 default -> /etc/nginx/sites-available/default

14. 接着在服务器远程连接终端中输入以下命令。在浏览器中打开http://39.96.9.216/ 即可以看到之前编写的网页了。
```shell
sudo rm /etc/nginx/sites-enabled/default
sudo systemctl reload nginx
../virtualenv/bin/python manage.py runserver
```

15. STAGING_SERVER=39.96.9.216 python manage.py test functional_tests

    > 出现from exc ^ SyntaxError: invalid syntax错误时可以编辑manage.py倒数第二行，删掉from exc。不要删掉。最后还是删了。
    > apt install python3-pip和pip3 intsall django。这两行似乎都没起作用

16. **Creating the Database with migrate**。依次输入以下代码。
```shell
../virtualenv/bin/python manage.py migrate --noinput
ls ../database
../virtualenv/bin/python manage.py runserver
```

> 不行python manage.py test functional_tests #第六章后的功能测试
> 不行python manage.py test lists #第六章后的单元测试
> 不行python3 manage.py test functional_tests #第六章后的功能测试
> 不行python3 manage.py test lists #第六章后的单元测试
>
> 不行python3.6 manage.py test functional_tests #第六章后的功能测试
> 不行python3.6 manage.py test lists #第六章后的单元测试
>
> FALIED../virtualenv/bin/python manage.py test functional_tests
> OK../virtualenv/bin/python manage.py test lists
>
> 以上在sites/39.96.9.216/source目录下运行

## 第九章 2019.5.21

1. **As Always, Start with a Test**。在functional_tests/tests.py中添加以下代码。运行功能测试`python manage.py test functional_tests`，会提示Ran 3 tests in 21.706s和OK。通过在本地输入`STAGING_SERVER=39.96.9.216 python manage.py test functional_tests`来运行在服务区上的功能测试。win10不行？
```python
import os
staging_server = os.environ.get('STAGING_SERVER')
if staging_server:
	self.live_server_url = 'http://' + staging_server
```

2. **Spinning Up a Server**。打开xshell连接到阿里云服务器，上面2、3、4。

绑定，修改映射？
更新xftp
> 留下你的评论
> Your text here