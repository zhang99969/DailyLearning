python manage.py runserver 启动服务器
python functional_tests.py 功能测试
python manage.py test 单元测试

python manage.py makemigrations 数据库迁移命令

## 第一章

1. Anaconda Prompt
 ```shell
pip install Django
 ```
2. 编写functional_tests.py
 ```python
from selenium import webdriver
browser = webdriver.Chrome()
browser.get('http://localhost:8000')
assert 'Django' in browser.title
 ```

3. 跳转到该目录下或powershell 输入
 ```shell
 django-damin.py startproject suplerlists
 ```

4. Anaconda Prompt
 ```shell
 python manage.py runserver
 ```

5. Spyder中运行functional_tests.py

6. 成功

7. 目录下打开Linux Shell
 ```shell
ls
mv functional_tests.py superlists/
cd superlists
 ```

8. 同步到github

## 第二章

1. 关掉所有的，更新functional_tests.py代码（第23张ppt）

2. 到目录\21 _Software Testing Technology\suplerlists处Anaconda Prompt
 ```shell
python manage.py runserver
 ```

3. Anaconda Prompt到目录处运行测试
 ```shell
python functional_tests.py
 ```
4. 新建functional_tests2.py并添加代码 (第30张ppt)

5. Anaconda Prompt运行
 ```shell
python functional_tests2.py
 ```

## 第三章

1. Anaconda Prompt到目录处
 ```shell
python manage.py startapp lists
 ```

2. 编辑list下的test.py    
 ```python
from django.test import TestCase
class SmokeTest(TestCase):
    def test_bad_maths(self):
   	 self.assertEqual(1 + 1, 3)
 ```

3. Anaconda Prompt到目录处
 ```shell
python manage.py test
 ```

4. 编辑list下的test.py    
 ```python
from django.urls import resolve
from django.test import TestCase
from lists.views import home_page
class HomePageTest(TestCase):
    def test_root_url_resolves_to_home_page_view(self):
        found = resolve('/')
        self.assertEqual(found.func, home_page)
 ```

5. Anaconda Prompt到目录处
 ```shell
python manage.py test
 ```

### 第三章小结 
- Running the Django dev server
 `python manage.py runserver`
- Running the functional tests
 `python functional_tests.py`
- Running the unit tests
 `python manage.py test`
- The unit-test/code cycle
> 1. Run the unit tests in the terminal.
> 2. Make a minimal code change in the editor.
> 3. Repeat!

## 第三章续

1. 上接15步，编辑好test.py。到目录处Anaconda Prompt

 ```python
python manage.py runserver
 ```

2. 到目录处新开Anaconda Prompt

 ```python
python manage.py test
 ```

3. 编辑views.py，添加

 ```python
from django.shortcuts import render
home_page = None
 ```
4. Anaconda Prompt重新运行（在目录处，以后略）

 ```python
python manage.py test
 ```

5. suplerlists\suplerlists中打开urls.py并改成

 ```python
from django.contrib import admin
from django.urls import path
from django.conf.urls import url
from lists import views
urlpatterns = [
    #path('admin/', admin.site.urls),
    url(r'^$',views.home_page,name='home'),
]
 ```

6. Anaconda Prompt运行

 ```python
python manage.py test
 ```

7. views.py改成

 ```python
from django.shortcuts import render
def home_page():
    pass
 ```
8. Anaconda Prompt运行

 ```python
python manage.py test
 ```

9. 成功

10. 修改test.py

 ```python
from django.urls import resolve
from django.test import TestCase
from django.http import HttpRequest
from lists.views import home_page
class HomePageTest(TestCase):
    def test_root_url_resolves_to_home_page_view(self):
        found = resolve('/')
        self.assertEqual(found.func, home_page)
    def test_home_page_returns_correct_html(self):
        request = HttpRequest()
        response = home_page(request)
        html = response.content.decode('utf8')
        self.assertTrue(html.startswith('<html>'))
        self.assertIn('<title>To-Do lists</title>', html)
        self.assertTrue(html.endswith('</html>'))
 ```
11. Anaconda Prompt运行

 ```python
python manage.py test
 ```
12. 多次修改view.py，最终改成
 ```python
from django.shortcuts import render
from django.http import HttpResponse
def home_page(request):
     return HttpResponse('<html><title>To-Do lists</title></html>')
 ```
13. Anaconda Prompt并运行单元测试
 ```python
python manage.py test
 ```
14. 成功
15. Anaconda Prompt运行功能测试，注意是tests2.py
 ```python
python functional_tests2.py
 ```
## 第四章

1.  TDD是一个长期的东西
2. Anaconda Prompt再运行一次功能测试`python functional_tests2.py`(如提示To-Do错误可能没开服务器)

3. 新建functional_tests3.py并添加代码 (第102张ppt，或4.pdf第41页)

4. Anaconda Prompt运行`python functional_tests3.py`，会提示
 ```shell
Unable to locate element: {"method":"tag name","selector":"h1"}
 ```
## 第四章续

1. Anaconda Prompt并运行单元测试`python manage.py test`，并提示成功

2. list目录下创建templates文件夹，并创建home.html文件，并填写
 ```html
<html>
    <title>To-Do lists</title>
</html>
 ```

3. 修改views.py为
 ```python
from django.shortcuts import render
def home_page(request):
    return render(request, 'home.html')
 ```

4. 运行`python manage.py test`，出现错误提示。
5. 打开settings.py，在INSTALLED_APPS中添加  `'lists',`

6. 运行`python manage.py test`，会有如下错误。（文本编译器不同，一般不会出错）（是断言home.html末尾是不是</html>）
 ```shell
    self.assertTrue(html.endswith('</html>'))
AssertionError: False is not true
 ```

7.  查看test.py代码，修改以下函数如下，其中4.pdf的47页中。
 ```python
 from django.template.loader import render_to_string
 	def test_home_page_returns_correct_html(self):
           request = HttpRequest()
           response = home_page(request)
           html = response.content.decode('utf8')
           expected_html = render_to_string('home.html')
           self.assertEqual(html, expected_html)
 ```

8. 再把以上函数改成4.pdf的47页中下方的代码。②和③一样。删掉②后如下，同时修改函数名为test_uses_home_template。
 ```python
           response = self.client.get('/')
           self.assertTemplateUsed(response, 'home.html')
 ```

9. 运行`python manage.py test`，提示成功。

10. 可以改成`self.assertTemplateUsed(response, 'hom2e.html')` 后再运行`python manage.py test`，会出现错误提示 `Template 'hom2e.html' was not a template used to render the response. Actual template(s) used: home.html`。再改成正确的。此时也可以把 test_root_url_resolves_to_home_page_view函数删掉了。

11. git中commit。

12. 修改home.html为如下，并`python functional_tests3.py`，提示 Unable to locate element: {"method":"id","selector":"id_new_item"}
 ```html
<html>
    <head>
        <title>To-Do lists</title>
    </head>
    <body>
        <h1>Your To-Do list</h1>
    </body>
</html>
 ```

13.多次修改home.html直至如下，并`python functional_tests3.py`，会提示any(row.text == '1: Buy peacock feathers' for row in rows)。

 ```html
<html>
    <head>
        <title>To-Do lists</title>
    </head>
​    <body>
        <h1>Your To-Do list</h1>
​        <input id="id_new_item" placeholder="Enter a to-do item" />
        <table id="id_list_table">
    </body>
</html>
 ```

14. functional_tests3.py中（参考4.pdf中52页）添加`"New to-do item did not appear in table"`后，并`python functional_tests3.py`，会提示AssertionError: False is not true : New to-do item did not appear in table。

## 续第五章

1. 修改home.html文件，中间部分几行修改如下，并功能测`python functional_tests3.py`，浏览器会提示Forbidden 403，CSRF verification failed，命令行会提示no such element: Unable to locate element: {"method":"id","selector":"id_list_table"}。
 ```html
   <form method="POST">
  <input name="item_text" id="id_new_item" placeholder="Enter a to-do item" />
   </form>
 ```
2. 如需要调试，可将functional_tests3.py中的time.sleep(1)改成10等时间。

3. 查看浏览器中详细的错误信息与建议，修改home.html如下，命令行会提示False is not true : New to-do item did not appear in table。
 ```html
           <form method="POST">
           <input name="item_tetxt" id="id_new_item" placeholder="Enter a to-do item" />
           {% csrf_token %}
           </form>
 ```
4. 可以将sleep改回来。

5. 修改test.py，添加以下函数，并运行单元测`python manage.py test`。命令行会提示'A new list item' not found in '<html>\n......'，

 ```python
   def test_can_save_a_POST_request(self):
       response = self.client.post('/', data={'item_text': 'A new list item'})
       self.assertIn('A new list item', response.content.decode())
 ```

6. 修改views.py，假装让测试通过。并运行单元测`python manage.py test`。测试通过。
 ```python
   def home_page(request):
       if request.method == 'POST':
           return HttpResponse(request.POST['item_text'])
       return render(request, 'home.html')
 ```

7. 修改home.html中部分内容，如下。修改test.py中的test_can_save_a_POST_request函数为如下。并运行单元测`python manage.py test`，会提示AssertionError: No templates used to render the response。

 ```html
   <table id="id_list_table">
       <tr><td>{{ new_item_text }}</td></tr>
   </table>
 ```
 ```python
   def test_can_save_a_POST_request(self):
       response = self.client.post('/', data={'item_text': 'A new list item'})
       self.assertIn('A new list item', response.content.decode())
       self.assertTemplateUsed(response, 'home.html')
 ```
8. 修改views.py的函数如下，并运行单元测`python manage.py test`，会提示 request.POST['item_text']等。
 ```python
    return render(request, 'home.html', {
            'new_item_text': request.POST['item_text'],
    })
 ```

9. 修改views.py的函数如下，并运行功能测`python functional_tests3.py`，会提示False is not true : New to-do item did not appear in table等。

 ```python
    return render(request, 'home.html', {
            'new_item_text': request.POST.get('item_text', ''),
    })
 ```

10. 修改functional_tests3.py中函数的内容如下，运行`python functional_tests3.py`后提示False is not true : New to-do item did not appear in table. Contents were:Buy peacock feathers，were后如果为空说明home.html写错了。
 ```python
   self.assertTrue(
       any(row.text == '1: Buy peacock feathers' for row in rows),
       f"New to-do item did not appear in table. Contents were:\n{table.text}"
      )
 ```
11. 上面四行改为，运行`python functional_tests3.py`后会提示AssertionError: '1: Buy peacock feathers' not found in ['Buy peacock feathers']

 ```python
 self.assertIn('1: Buy peacock feathers', [row.text for row in rows]
 ```

12. 可修改home.html中代码为`<tr><td>1: {{ new_item_text }}</td></tr>`

13. 修改functional_tests3.py为functional_tests4.py中的代码，运行`python functional_tests4.py`后会提示AssertionError: '1: Buy peacock feathers' not found in ['Buy peacock feathers']

14. functional_tests4.py中的tearDown函数下添加如下函数。

 ```python
 def check_for_row_in_list_table(self, row_text):
    table = self.browser.find_element_by_id('id_list_table')
    rows = table.find_elements_by_tag_name('tr')
    self.assertIn(row_text, [row.text for row in rows])
 ```

15. 修改为functional_tests5.py中的代码，运行`python functional_tests5.py`后会提示AssertionError: '1: Buy peacock feathers' not found in ['Buy peacock feathers']

16. 修改tests.py函数，添加新的类，运行`python manage.py test`，会提示ImportError: cannot import name 'Item'
 ```python
from lists.models import Item
class ItemModelTest(TestCase):
     def test_saving_and_retrieving_items(self):
         略
 ```
17. 修改modelss.py，添加如下代码后再运行`python manage.py test`，会提示AttributeError: 'Item' object has no attribute 'save'。修改代码`Item为Item(models.Model)`，再运行`python manage.py test`，会有很多错误和django.db.utils.OperationalError: no such table: lists_item提示。
 ```python
class Item(object):
    pass
 ```

18. 数据库迁移命令`python manage.py makemigrations`，会提示- Create model Item。也可以看到新建了migrations文件夹，下有0001_initial.py、____init____.py和____pycache____文件夹。
19. 运行单元测试`python manage.py test lists`，提示AttributeError: 'Item' object has no attribute 'text'。
20. 修改models.py函数内容为`text = models.TextField()`，运行`python manage.py test lists`，会提示django.db.utils.OperationalError: no such column: lists_item.text。运行`python manage.py makemigrations`，并输入2退出。修改models.py函数内容为`text = models.TextField(default='')`，运行`python manage.py makemigrations`，会提示    - Add field text to item。最后运行`python manage.py test lists`，会提示OK通过。

## 第五章续